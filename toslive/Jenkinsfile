// This jenkinsfile should only be ran on arch based devices
// Make sure your slave or runner is running arch
// The uploading to the remote repository counts that there is a local repository present.
node('archlinux') {
   stage('pull') { 
        git "https://github.com/F0xedb/tos-live.git"
    }
    // Build tos server edition
    stage('server'){
        sh "cd toslive && sudo sh start.sh -s" // run start.sh as a root user since the live iso chroot is a root user
    }
    // Build tos client edition
    stage('client'){
        sh "cd toslive && sudo sh start.sh -g" // run start.sh as a root user since the live iso chroot is a root user
    }
    // Build tos server edition with azerty layout
    stage('server azerty'){
        sh "cd toslive && sudo sh start.sh -s -a" // run start.sh as a root user since the live iso chroot is a root user
    }
    // Build tos client edition with azerty layout
    stage('client azerty'){
        sh "cd toslive && sudo sh start.sh -g -a" // run start.sh as a root user since the live iso chroot is a root user
    }
    // Copy local tos builds to local repository
    stage('copy'){
        sh "cd repo && sh build.sh -u"
    }
    // Upload iso's to remote repository
    stage('upload') {
        sh "cd repo && sh upload.sh -y" 
    }
}
