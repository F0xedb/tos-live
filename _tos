#compdef _tos tos

_tos_subcommands() {
  local commands; commands=(
    '-iso:Install TOS onto your system'
    '-S:Install a package'
    '-R:Remove a package'
    {-m,--metric}':Change the network metric of a device'
    {-cw,--change-wifi}':Login to a different network based on its SSID'
    {-t,--theme}':Change the system theme and background to an image'
    {-ta,--theme-add}':Add a theme to the random theme generator'
    {-td,--theme-delete}':Delete a theme from the generator'
    {-tr,--theme-random}':Enable or disable random theme generator'
    {-h,--help}":Show help imformation" \
    {-u,--update}":Update the system to the latest version" \
    {-c,--crypto}":Add a ssh key, when a user@ip is specified add current key to that host" \
    {-dl,--device-list}":List all active network devices" \
    {-r,--restart-network}":Restart the network stack" \
    {-lw,--list-wifi}":List all active wifi devices in the area" \
    {-rs,--repair-system}":Perform a system repair (this will take a long time)" \
    {-tl,--theme-list}":List all entries that are present in the theme file" \
  )
  _describe -t commands 'subcommands' commands "$@"
}

function _tos {
    local context curcontext="$curcontext" state line
    typeset -A opt_args

    local ret=1
    
    _arguments -C \
        '1: :_tos_subcommands' \
        '*::arg:->args' 

    case $line[1] in
        "-iso")
            _tos_install_graphical
            ;;
        "-S"*)
            _tos_S_install
            ;;
        "-R"*)
            _tos_R_remove
            ;;
        "-m")
            _tos_metric
            ;;
        "-cw")
            _tos_wifi_connect
            ;;
        "-t")
            _tos_change_theme
            ;;
        "-ta")
            _tos_add_theme
            ;;
        "-td")
            _tos_delete_theme
            ;;
        "-tr")
            _tos_random_theme
            ;;
    esac
}

function _tos_add_theme {
        _arguments -C\
        '*:Images:_files -g "*.jpg|*.png|*.jpeg"'\
}

function _tos_delete_theme {
        list=$(cat ~/.config/tos/theme | awk '$0 !~ /^on|^off/{print $0}')
        _arguments -C\
        "1: :($list)"
}

function _tos_random_theme {
        _arguments -C\
        "1: :(on off)"
}

function _tos_change_theme {
    _arguments -C\
    '*:Images:_files -g "*.jpg|*.png|*.jpeg"'\
}

function _tos_wifi_connect {
   list=$(nmcli d wifi list | awk '$1 !~ /IN-USE|*/{print $0}' | grep -Eo '^.* Infra' | sed 's/Infra//' | awk '{print "\""$0"\""}' | sed -r -e 's/^\"\s+/\"/g' -e 's/\s*\"/\"/g')
   _arguments -C\
   "1: :($list)"
}

function _tos_metric {
    list=$(ip link show up | awk '$1 ~ /[0-9]*:.*/{printf $2}' | tr ':' ' ') 
    _arguments -C \
    "1: :($list)"
}

function _tos_install_graphical {
    _arguments \
    "-g[Install with a gui (Omit if you want a text based installer)]"
}

function _tos_install_package {
    local line
    _arguments -C -s\
    "1: :(-S -R)" \
    "*::arg:->args"

    case $line[1] in
        "-S"*)
            _tos_S_install
            ;;
        "-R"*)
            _tos_R_remove
            ;;
    esac
}

function _tos_S_install {
    _arguments -s \
    "-yu[Sync and update database]"\
    "-yyu[Force download database and sync with remote repo's]"\
    "-y[Sync databases with remote repo]" \
    "-yy[force reload with remote repo]" \
    "-a[Assume targets are from the AUR]" \
    "-b[Alternative database localation]" \
    "-c[Remove old packages from the cache]" \
    "-d[Skip dependency cheks]" \
    "-g[View all members of a package group]" \
    "-h[Display syntax for the fiven operation]" \
    "-i[View package information]" \
    "-l[List all packages in a repo]" \
    "-p[Prind download URI's for each package]" \
    "-q[Show less info about queries and searches]" \
    "-r[Set alternative install root]" \
    "-s[Search package names and descrptions]" \
    "-u[Upgrade all out-of-date packages]" \
    "-v[Be more verbose]" \
    "-w[Download packages only]" \
    "-s[search for a package]"\
}

function _tos_R_remove {
    _arguments -s \
    "-ns[Remove packages with all its dependencies and config files]" \
    "-a[Assume targets are from the AUR]" \
    "-b[Alternate database location]" \
    "-c[Remove all dependent packages]" \
    "-d[Skip dependency checks]" \
    "-h[Display syntaxt for a given operation]" \
    "-n[Remove protected configuration files]" \
    "-p[Only print the targets instead of perfomring the operation]" \
    "-r[Set alternative installation root]" \
    "-s[Remove dependencies not required by other packages]" \
    "-u[Remove unneeded packages]" \
    "-v[Be more verbose]"
}
